spring:
  docker:
    compose:
      enabled: true
  jackson:
    time-zone: Asia/Seoul

  datasource:
    url: jdbc:h2:mem:db_test;MODE=MySQL
    driver-class-name: org.h2.Driver
    username: sa
    password:
    hikari:
      maximum-pool-size: 50
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  data:
    redis:
      host: localhost
      port: 6379

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.H2Dialect

# 아래 key 값들은 실제로 사용하는 키 값이 아닌 테스트용 더미 값입니다.
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: dummy-google-client-id
            client-secret: dummy-google-client-secret
            scope:
              - profile
              - email
              - dummy-uri
        provider:
          google:
            authorization-uri: dummy-uri

security:
  encryption:
    aes-key: "MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTI="
    sha-salt: "test-salt-for-phone-number-hashing"

jwt:
  secret: "test-jwt-secret-key-minimum-32-bytes-required-for-hs256-algorithm-!!!"
  access-token:
    expiration: 10800000 # 3시간
  refresh-token:
    expiration: 2592000000 # 30일

cors:
  allowed-origins: http://localhost:3000
  capsule-domain: http://localhost:3000

coolsms:
  api-key: dummy-api-key
  api-secret: dummy-api-secret
  from-number: "01000000000"

openai:
  enabled: false

  api:
    key: DUMMY_KEY_DO_NOT_USE

  moderation:
    enabled: false
    model: dummy
    block-on-flagged: false   # true면 flagged 시 저장 막음
    fail-closed: false        # true면 OpenAI 장애 시 저장 막음

app:
  s3:
    bucket: test-bucket
    prefix: capsules
    region: us-east-1

google:
  drive:
    client-id: dummy-google-client-id
    client-secret: dummy-google-client-secret
    redirect-uri: dummy-google-drive-redirect-uri

resilience4j:
  ratelimiter:
    instances:
      coolsmsSend:
        limitForPeriod: 10          # period당 허용 호출 수   5초에 10번 허용 -> 보수적으로 설정
        limitRefreshPeriod: 5s      # period
        timeoutDuration: 0          # 토큰 없으면 즉시 실패(대기 X)
  retry:
    instances:
      coolsmsSend:
        maxAttempts: 3               # 총 3번 시도 (최초 호출 + 2번 재시도)
        waitDuration: 300ms
        retryExceptions:
          - java.net.SocketTimeoutException
          - java.net.ConnectException
          - java.io.IOException
        ignoreExceptions:
          - back.fcz.global.exception.BusinessException
  circuitbreaker:
    instances:
      coolsmsSend:
        slidingWindowType: COUNT_BASED
        slidingWindowSize: 10
        minimumNumberOfCalls: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10s             # 오픈 상태 지속 시간 10초
        permittedNumberOfCallsInHalfOpenState: 3 # half-open 상태에서 closed로 전환 하기 위한 테스트 호출 수
        recordExceptions:
          - java.net.SocketTimeoutException
          - java.net.ConnectException
          - java.io.IOException